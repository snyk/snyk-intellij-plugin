package snyk.oss

import com.google.gson.annotations.Expose
import com.google.gson.annotations.SerializedName
import io.snyk.plugin.Severity

class Vulnerability {

    // todo: replace lateinit with nullable val(r) or do pre-transformation of data to address possible json field absence
    lateinit var id: String
    var license: String? = null
    var identifiers: Identifiers? = null
    lateinit var title: String
    lateinit var description: String
    lateinit var language: String
    lateinit var packageManager: String
    lateinit var packageName: String
    lateinit var severity: String
    lateinit var name: String
    lateinit var version: String
    var exploit: String? = null

    @SerializedName("CVSSv3") var cvssV3: String? = null
    var cvssScore: String? = null

    var fixedIn: Array<String>? = null
    lateinit var from: Array<String>
    lateinit var upgradePath: Array<String>

    @Expose
    val obsolete: Boolean = false
    @Expose
    val ignored: Boolean = false

    fun getPackageNameTitle(): String = "$packageName@$version: $title"

    // todo: (by Pavel)
    //  How about using comparator for tree nodes? Issue I see atm: this code cannot handle other issues e.g. critical if this will come later.
    fun getSeverityIndex(): Int = Severity.getIndex(severity)

}

class Identifiers {
    @SerializedName("CWE")
    lateinit var cwe: List<String>
    @SerializedName("CVE")
    lateinit var cve: List<String>
}
